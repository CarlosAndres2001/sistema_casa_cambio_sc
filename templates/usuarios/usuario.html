{% extends 'base.html' %}

{% block title %}
Usuarios
{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<h2 align="center">Registro de usuarios del sistema</h2>
<form method="POST" action="{% url 'registrar_usuario' %}">
    {% csrf_token %}
    <br>
    <div class="row">
        <!-- Columna de Datos Personales (izquierda) -->
        <div class="col-md-6 mb-3" style="border-right: 2px solid #ccc; padding-right: 20px;">
            <h2 align="center">Datos Personales</h2>
            <label for="nombre" class="form-label">Nombres:</label>
            <input type="text" name="nombre" id="nombre" class="form-control" placeholder="Nombre" required>

            <label for="apellido" class="form-label">Apellidos:</label>
            <input type="text" name="apellido" id="apellido" class="form-control" placeholder="Apellido" required>

            <label for="fecha_nac" class="form-label">Fecha de Nacimiento:</label>
            <input type="date" name="fecha_nac" id="fecha_nac" class="form-control">

            <label for="cedula_identidad" class="form-label">Cédula de Identidad:</label>
            <input type="text" name="cedula_identidad" id="cedula_identidad" class="form-control" placeholder="Cédula de Identidad" required>
        </div>
        <!-- Columna de Datos de Usuario (derecha) -->
        <div class="col-md-6 mb-3">
            <h2 align="center">Datos de Usuario</h2>
            <label for="nombre_usu" class="form-label">Nombre de Usuario:</label>
            <input type="text" name="nombre_usu" id="nombre_usu" class="form-control" placeholder="Nombre de Usuario" required>

            <label for="contrasena" class="form-label">Contraseña:</label>
            <input type="password" name="contrasena" id="contrasena" class="form-control" placeholder="Contraseña" required>

            <label for="roles" class="form-label">Rol Seleccionado:</label>
            <select id="roles" name="roles" class="form-select shadow-sm" required> 
                <option value="" selected disabled>Seleccione un rol</option>
                {% for roles in roles %}
                    <option value="{{ roles.id_rol }}">{{ roles.nombre_rol }}</option>
                {% endfor %}
            </select>
            <label for="sucursal" class="form-label">Sucursal Asignada</label>
            <select id="sucursal" name="sucursal" class="form-control" required>
                <option value="" selected disabled>Seleccione una sucursal</option>
                {% for sucursales in sucursales %}
                    <option value="{{ sucursales.id_sucursal }}">{{ sucursales.nombre_sucursal }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="actions" align="center">
        <button type="submit" class="btn btn-primary mx-2">Registrar Usuario</button>
        <button type="reset" class="btn btn-danger mx-2">Cancelar</button>
        <button type="button" class="btn btn-primary mx-2" data-bs-toggle="modal" data-bs-target="#modalRol">Crear Rol</button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const alert = document.querySelector('.alert');
            if (alert) {
                setTimeout(function() {
                    alert.classList.remove('show'); 
                }, 5000); 
            }
        });
    </script>

    {% if messages %}
        <div class="alert alert-dismissible fade show" role="alert">
            {% for message in messages %}
                <div class="alert {{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
</form>

<div class="modal fade" id="modalRol" tabindex="-1" aria-labelledby="modalRolLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalRolLabel">Crear Rol</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form-rol" action="{% url 'crear_rol' %}" method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="nombre_rol" class="form-label">Nombre del Rol</label>
                        <input type="text" class="form-control" id="nombre_rol" name="nombre_rol" required>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Crear Rol</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </form>                    
            </div>
        </div>
    </div>
</div>
{% endblock %}
